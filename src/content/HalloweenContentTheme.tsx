/**
 * Halloween Content Theme - For content script injection
 * Creates a safe, user-controlled Halloween atmosphere
 */

class HalloweenContentTheme {
  private enabled = false;
  private elements: HTMLElement[] = [];
  private intervals: number[] = [];

  constructor() {
    // Spider webs are created dynamically in createSpiderWebSvg method
  }

  private createSpiderWebSvg(isLeft: boolean): string {
    const isDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    const fillColor = isDarkMode ? 'rgba(255, 255, 255, 0.8)' : 'rgba(100, 100, 100, 0.7)';
    
    if (isLeft) {
      // Left spider web - noun-spiderweb-704550.svg (made bigger for visual impact)
      return `<svg width="300" height="300" viewBox="0 0 100 125" xmlns="http://www.w3.org/2000/svg">
        <path d="M68.613,23.714H31.404c-0.002,0-0.002,0.001-0.002,0.001h-0.015l0,0l0,0c-0.006,0-0.012,0.002-0.017,0.003  c-0.014,0-0.026,0.002-0.041,0.005c-0.014,0.003-0.026,0.006-0.041,0.011c-0.012,0.004-0.024,0.01-0.036,0.016  c-0.005,0.002-0.011,0.002-0.017,0.006c-0.006,0.003-0.009,0.008-0.014,0.012c-0.011,0.007-0.021,0.016-0.031,0.025  c-0.012,0.009-0.021,0.019-0.031,0.029c-0.004,0.004-0.01,0.008-0.015,0.012c-0.004,0.006-0.006,0.013-0.008,0.019  c-0.004,0.006-0.009,0.009-0.013,0.015s-0.004,0.012-0.006,0.017c-0.008,0.012-0.012,0.024-0.017,0.037  c-0.004,0.013-0.007,0.026-0.009,0.041c-0.003,0.013-0.005,0.024-0.006,0.038c-0.001,0.006-0.003,0.012-0.003,0.019v37.208  c0,0.168,0.136,0.303,0.301,0.303c0.167,0,0.301-0.135,0.301-0.303v-2.172c3.431-5.909,11.013-7.948,16.944-4.566l1.1,1.904  c0.055,0.096,0.155,0.15,0.26,0.15c0,0,0,0,0.002,0l0,0c0.051,0,0.103-0.014,0.148-0.041c0.145-0.082,0.193-0.269,0.11-0.411  l-1.085-1.882c0.015-6.754,5.434-12.258,12.152-12.42v27.463c-0.338,0.144-0.578,0.507-0.578,0.939c0,0.271,0.095,0.516,0.25,0.696  c-0.891-0.271-1.539-1.101-1.539-2.074c0-0.834,0.488-1.604,1.242-1.961c0.148-0.069,0.213-0.253,0.143-0.401  c-0.071-0.148-0.25-0.215-0.401-0.144c-0.963,0.456-1.585,1.438-1.585,2.506c0,0.347,0.067,0.679,0.182,0.982  c-0.522-0.604-0.84-1.388-0.84-2.246c0-0.166-0.137-0.304-0.305-0.304c-0.166,0-0.301,0.138-0.301,0.304  c0,1.687,1.039,3.131,2.51,3.731c-1.471,0.605-2.51,2.051-2.51,3.735c0,0.165,0.135,0.301,0.301,0.301  c0.168,0,0.305-0.136,0.305-0.301c0-0.858,0.317-1.644,0.84-2.246c-0.115,0.306-0.182,0.638-0.182,0.981  c0,1.065,0.622,2.051,1.585,2.506c0.042,0.021,0.086,0.029,0.128,0.029c0.114,0,0.223-0.063,0.272-0.172  c0.071-0.149,0.007-0.332-0.144-0.402c-0.754-0.356-1.24-1.126-1.24-1.961c0-0.956,0.623-1.77,1.484-2.055  c-0.375,0.293-0.627,0.82-0.627,1.428c0,0.926,0.587,1.678,1.313,1.678c0.723,0,1.311-0.752,1.311-1.678  c0-0.605-0.252-1.135-0.626-1.428c0.86,0.285,1.483,1.099,1.483,2.055c0,0.835-0.485,1.604-1.239,1.961  c-0.151,0.07-0.215,0.253-0.144,0.402c0.051,0.108,0.16,0.172,0.271,0.172c0.043,0,0.087-0.011,0.128-0.029  c0.963-0.455,1.586-1.438,1.586-2.506c0-0.346-0.067-0.676-0.185-0.981c0.525,0.603,0.845,1.388,0.845,2.246  c0,0.165,0.136,0.301,0.301,0.301c0.168,0,0.302-0.136,0.302-0.301c0-1.687-1.039-3.131-2.509-3.733  c1.47-0.603,2.509-2.049,2.509-3.731c0-0.166-0.134-0.304-0.302-0.304c-0.166,0-0.301,0.138-0.301,0.304  c0,0.858-0.319,1.646-0.845,2.246c0.117-0.308,0.185-0.638,0.185-0.982c0-1.065-0.623-2.05-1.586-2.506  c-0.149-0.071-0.33-0.007-0.401,0.144c-0.07,0.149-0.006,0.332,0.145,0.401c0.754,0.354,1.24,1.127,1.24,1.961  c0,0.978-0.649,1.804-1.537,2.074c0.154-0.183,0.249-0.426,0.249-0.696c0-0.435-0.241-0.798-0.578-0.939v-27.26l1.537,0.888  c0.048,0.028,0.099,0.041,0.151,0.041c0.104,0,0.205-0.054,0.26-0.151c0.021-0.035,0.035-0.074,0.039-0.113  c0.015-0.117-0.041-0.236-0.148-0.3l-1.88-1.086c-3.403-5.925-1.378-13.51,4.519-16.954h2.197c0,0,0.001,0,0.002,0h0.014  c0.168,0,0.301-0.136,0.301-0.302C68.914,23.849,68.779,23.714,68.613,23.714z M31.689,25.142l6.441,11.155  c-2.29-0.903-4.92-0.192-6.441,1.743V25.142z M32.213,24.841l11.154,6.439c-2.434,0.361-4.356,2.293-4.705,4.73L32.213,24.841z   M32.514,24.317h12.881c-1.926,1.53-2.627,4.163-1.71,6.449L32.514,24.317z M31.689,39.079c0.027-0.021,0.053-0.047,0.07-0.08  c1.376-2.383,4.434-3.201,6.814-1.826c0.024,0.014,0.049,0.019,0.076,0.025l4.479,7.756c-4.044-1.873-8.885-0.566-11.439,3.086  V39.079z M39.181,36.909c0.011-0.033,0.021-0.067,0.021-0.104c0-2.75,2.238-4.988,4.99-4.988c0.027,0,0.053-0.009,0.077-0.016  l7.755,4.478c-2.15,0.192-4.147,1.121-5.693,2.666c-1.553,1.555-2.483,3.563-2.668,5.727L39.181,36.909z M44.584,31.286  c-0.006-0.035-0.016-0.069-0.034-0.102c-1.375-2.382-0.558-5.439,1.826-6.814c0.024-0.014,0.04-0.033,0.059-0.051h8.957  c-3.642,2.564-4.933,7.409-3.046,11.448L44.584,31.286z M31.689,57.929v-8.813c0.034-0.024,0.066-0.055,0.088-0.094  c2.381-4.123,7.67-5.541,11.795-3.16c0.033,0.019,0.064,0.027,0.1,0.032l4.4,7.622C42.287,50.76,35.307,52.639,31.689,57.929z   M48.605,53.233l-4.406-7.631c0.018-0.039,0.029-0.08,0.029-0.125c-0.001-2.307,0.897-4.475,2.529-6.105  c1.631-1.631,3.799-2.528,6.105-2.528c0.037,0,0.069-0.009,0.103-0.021l7.622,4.399C54.199,41.726,49.094,46.843,48.605,53.233z   M60.908,40.711l-7.631-4.406c-0.006-0.042-0.017-0.083-0.037-0.123c-2.383-4.124-0.963-9.415,3.158-11.795  c0.032-0.019,0.059-0.042,0.08-0.069h8.801C59.998,27.948,58.136,34.932,60.908,40.711z" 
             fill="${fillColor}" />
      </svg>`;
    } else {
      // Right spider web - mirrored version of left web for perfect symmetry
      return `<svg width="300" height="300" viewBox="0 0 100 125" xmlns="http://www.w3.org/2000/svg">
        <g transform="scale(-1, 1) translate(-100, 0)" fill="${fillColor}">
          <path d="M68.613,23.714H31.404c-0.002,0-0.002,0.001-0.002,0.001h-0.015l0,0l0,0c-0.006,0-0.012,0.002-0.017,0.003  c-0.014,0-0.026,0.002-0.041,0.005c-0.014,0.003-0.026,0.006-0.041,0.011c-0.012,0.004-0.024,0.01-0.036,0.016  c-0.005,0.002-0.011,0.002-0.017,0.006c-0.006,0.003-0.009,0.008-0.014,0.012c-0.011,0.007-0.021,0.016-0.031,0.025  c-0.012,0.009-0.021,0.019-0.031,0.029c-0.004,0.004-0.01,0.008-0.015,0.012c-0.004,0.006-0.006,0.013-0.008,0.019  c-0.004,0.006-0.009,0.009-0.013,0.015s-0.004,0.012-0.006,0.017c-0.008,0.012-0.012,0.024-0.017,0.037  c-0.004,0.013-0.007,0.026-0.009,0.041c-0.003,0.013-0.005,0.024-0.006,0.038c-0.001,0.006-0.003,0.012-0.003,0.019v37.208  c0,0.168,0.136,0.303,0.301,0.303c0.167,0,0.301-0.135,0.301-0.303v-2.172c3.431-5.909,11.013-7.948,16.944-4.566l1.1,1.904  c0.055,0.096,0.155,0.15,0.26,0.15c0,0,0,0,0.002,0l0,0c0.051,0,0.103-0.014,0.148-0.041c0.145-0.082,0.193-0.269,0.11-0.411  l-1.085-1.882c0.015-6.754,5.434-12.258,12.152-12.42v27.463c-0.338,0.144-0.578,0.507-0.578,0.939c0,0.271,0.095,0.516,0.25,0.696  c-0.891-0.271-1.539-1.101-1.539-2.074c0-0.834,0.488-1.604,1.242-1.961c0.148-0.069,0.213-0.253,0.143-0.401  c-0.071-0.148-0.25-0.215-0.401-0.144c-0.963,0.456-1.585,1.438-1.585,2.506c0,0.347,0.067,0.679,0.182,0.982  c-0.522-0.604-0.84-1.388-0.84-2.246c0-0.166-0.137-0.304-0.305-0.304c-0.166,0-0.301,0.138-0.301,0.304  c0,1.687,1.039,3.131,2.51,3.731c-1.471,0.605-2.51,2.051-2.51,3.735c0,0.165,0.135,0.301,0.301,0.301  c0.168,0,0.305-0.136,0.305-0.301c0-0.858,0.317-1.644,0.84-2.246c-0.115,0.306-0.182,0.638-0.182,0.981  c0,1.065,0.622,2.051,1.585,2.506c0.042,0.021,0.086,0.029,0.128,0.029c0.114,0,0.223-0.063,0.272-0.172  c0.071-0.149,0.007-0.332-0.144-0.402c-0.754-0.356-1.24-1.126-1.24-1.961c0-0.956,0.623-1.77,1.484-2.055  c-0.375,0.293-0.627,0.82-0.627,1.428c0,0.926,0.587,1.678,1.313,1.678c0.723,0,1.311-0.752,1.311-1.678  c0-0.605-0.252-1.135-0.626-1.428c0.86,0.285,1.483,1.099,1.483,2.055c0,0.835-0.485,1.604-1.239,1.961  c-0.151,0.07-0.215,0.253-0.144,0.402c0.051,0.108,0.16,0.172,0.271,0.172c0.043,0,0.087-0.011,0.128-0.029  c0.963-0.455,1.586-1.438,1.586-2.506c0-0.346-0.067-0.676-0.185-0.981c0.525,0.603,0.845,1.388,0.845,2.246  c0,0.165,0.136,0.301,0.301,0.301c0.168,0,0.302-0.136,0.302-0.301c0-1.687-1.039-3.131-2.509-3.733  c1.47-0.603,2.509-2.049,2.509-3.731c0-0.166-0.134-0.304-0.302-0.304c-0.166,0-0.301,0.138-0.301,0.304  c0,0.858-0.319,1.646-0.845,2.246c0.117-0.308,0.185-0.638,0.185-0.982c0-1.065-0.623-2.05-1.586-2.506  c-0.149-0.071-0.33-0.007-0.401,0.144c-0.07,0.149-0.006,0.332,0.145,0.401c0.754,0.354,1.24,1.127,1.24,1.961  c0,0.978-0.649,1.804-1.537,2.074c0.154-0.183,0.249-0.426,0.249-0.696c0-0.435-0.241-0.798-0.578-0.939v-27.26l1.537,0.888  c0.048,0.028,0.099,0.041,0.151,0.041c0.104,0,0.205-0.054,0.26-0.151c0.021-0.035,0.035-0.074,0.039-0.113  c0.015-0.117-0.041-0.236-0.148-0.3l-1.88-1.086c-3.403-5.925-1.378-13.51,4.519-16.954h2.197c0,0,0.001,0,0.002,0h0.014  c0.168,0,0.301-0.136,0.301-0.302C68.914,23.849,68.779,23.714,68.613,23.714z M31.689,25.142l6.441,11.155  c-2.29-0.903-4.92-0.192-6.441,1.743V25.142z M32.213,24.841l11.154,6.439c-2.434,0.361-4.356,2.293-4.705,4.73L32.213,24.841z   M32.514,24.317h12.881c-1.926,1.53-2.627,4.163-1.71,6.449L32.514,24.317z M31.689,39.079c0.027-0.021,0.053-0.047,0.07-0.08  c1.376-2.383,4.434-3.201,6.814-1.826c0.024,0.014,0.049,0.019,0.076,0.025l4.479,7.756c-4.044-1.873-8.885-0.566-11.439,3.086  V39.079z M39.181,36.909c0.011-0.033,0.021-0.067,0.021-0.104c0-2.75,2.238-4.988,4.99-4.988c0.027,0,0.053-0.009,0.077-0.016  l7.755,4.478c-2.15,0.192-4.147,1.121-5.693,2.666c-1.553,1.555-2.483,3.563-2.668,5.727L39.181,36.909z M44.584,31.286  c-0.006-0.035-0.016-0.069-0.034-0.102c-1.375-2.382-0.558-5.439,1.826-6.814c0.024-0.014,0.04-0.033,0.059-0.051h8.957  c-3.642,2.564-4.933,7.409-3.046,11.448L44.584,31.286z M31.689,57.929v-8.813c0.034-0.024,0.066-0.055,0.088-0.094  c2.381-4.123,7.67-5.541,11.795-3.16c0.033,0.019,0.064,0.027,0.1,0.032l4.4,7.622C42.287,50.76,35.307,52.639,31.689,57.929z   M48.605,53.233l-4.406-7.631c0.018-0.039,0.029-0.08,0.029-0.125c-0.001-2.307,0.897-4.475,2.529-6.105  c1.631-1.631,3.799-2.528,6.105-2.528c0.037,0,0.069-0.009,0.103-0.021l7.622,4.399C54.199,41.726,49.094,46.843,48.605,53.233z   M60.908,40.711l-7.631-4.406c-0.006-0.042-0.017-0.083-0.037-0.123c-2.383-4.124-0.963-9.415,3.158-11.795  c0.032-0.019,0.059-0.042,0.08-0.069h8.801C59.998,27.948,58.136,34.932,60.908,40.711z" />
        </g>
      </svg>`;
    }
  }

  private createGhostSvg(): string {
    const isDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    const fillColor = isDarkMode ? 'rgba(255, 255, 255, 0.9)' : 'rgba(255, 255, 255, 0.95)';
    const strokeColor = isDarkMode ? 'rgba(255, 255, 255, 0.3)' : 'rgba(100, 100, 100, 0.3)';
    
    // Original ghost SVG from noun-ghost-8132793.svg with proper styling
    return `<svg width="50" height="50" viewBox="-5.0 -10.0 110.0 135.0" xmlns="http://www.w3.org/2000/svg">
      <g fill="${fillColor}" stroke="${strokeColor}" stroke-width="1">
        <path d="m45.16 40.871c0.33984-0.44922 0.53125-0.85938 0.69922-1.2891 0.23828-0.64062 0.39844-1.3086 0.51172-2.0391 0.10938-0.73047 0.17188-1.5117 0.17188-2.3398 0-1.4414-0.16016-2.7383-0.5-3.8789-0.17969-0.57031-0.39062-1.1094-0.78906-1.6914-0.21094-0.28906-0.46875-0.58984-0.89062-0.87891-0.41016-0.28125-1.0117-0.51953-1.6719-0.51953s-1.2695 0.23828-1.6719 0.51953c-0.35938 0.25-0.60938 0.51172-0.80859 0.76953-0.33984 0.44922-0.53125 0.85937-0.69922 1.2891-0.23828 0.64062-0.39844 1.3086-0.51172 2.0391-0.10938 0.73047-0.17188 1.5117-0.17188 2.3398 0 1.4414 0.16016 2.7383 0.5 3.8789 0.17969 0.57031 0.39062 1.1094 0.78906 1.6914 0.21094 0.28906 0.46875 0.58984 0.89062 0.87891 0.41016 0.28125 1.0117 0.51953 1.6719 0.51953 0.66016 0 1.2695-0.23828 1.6719-0.51953 0.35938-0.25 0.60938-0.51172 0.80859-0.76953z" />
        <path d="m62.238 29.809c-0.21094-0.28906-0.46875-0.58984-0.89062-0.87891-0.41016-0.28125-1.0117-0.51953-1.6719-0.51953-0.66016 0-1.2695 0.23828-1.6719 0.51953-0.35938 0.25-0.60938 0.51172-0.80859 0.76953-0.33984 0.44922-0.53125 0.85938-0.69922 1.2891-0.23828 0.64062-0.39844 1.3086-0.51172 2.0391-0.10938 0.73047-0.17188 1.5117-0.17188 2.3398 0 1.4414 0.16016 2.7383 0.5 3.8789 0.17969 0.57031 0.39062 1.1094 0.78906 1.6914 0.21094 0.28906 0.46875 0.58984 0.89063 0.87891 0.41016 0.28125 1.0117 0.51953 1.6719 0.51953 0.66016 0 1.2695-0.23828 1.6719-0.51953 0.35937-0.25 0.60937-0.51172 0.80859-0.76953 0.33984-0.44922 0.53125-0.85938 0.69922-1.2891 0.23828-0.64062 0.39844-1.3086 0.51172-2.0391 0.10938-0.73047 0.17188-1.5117 0.17188-2.3398 0-1.4414-0.16016-2.7383-0.5-3.8789-0.17969-0.57031-0.39062-1.1094-0.78906-1.6914z" />
        <path d="m57.02 48.301c-0.35156-0.26172-0.60156-0.35938-0.82812-0.46094-0.39062-0.14844-0.73047-0.23047-1.0898-0.30078-0.53906-0.10156-1.1406-0.17187-1.8086-0.23047-0.67188-0.050782-1.3984-0.078125-2.1719-0.078125-1.3398 0-2.5391 0.078125-3.5312 0.23047-0.5 0.078124-0.92969 0.16016-1.4219 0.32812-0.25 0.10156-0.51953 0.19141-0.89844 0.46875-0.19141 0.14063-0.42188 0.33984-0.66016 0.67969-0.23047 0.32812-0.44922 0.87109-0.44922 1.4609 0 0.58984 0.21875 1.1289 0.44922 1.4609 0.21875 0.32031 0.44141 0.51953 0.62109 0.66016 0.35156 0.26172 0.60156 0.35938 0.82812 0.46094 0.39062 0.14844 0.73047 0.23047 1.0898 0.30078 0.53906 0.10156 1.1406 0.17188 1.8086 0.23047 0.67188 0.050781 1.3984 0.078125 2.1719 0.078125 1.3398 0 2.5391-0.078125 3.5312-0.23047 0.5-0.078125 0.92969-0.16016 1.4219-0.32812 0.25-0.10156 0.51953-0.19141 0.89844-0.46875 0.19141-0.14062 0.42188-0.33984 0.66016-0.67969 0.23047-0.32812 0.44922-0.87109 0.44922-1.4609s-0.21875-1.1289-0.44922-1.4609c-0.21875-0.32031-0.44141-0.51953-0.62109-0.66016z" />
        <path d="m86.73 79.441c-0.67188-1.9805-1.6016-3.9688-2.4609-6.3086-0.87109-2.3398-1.6797-5.0195-2.1406-8.3281-0.12891-0.91016-0.25-2.4805-0.48828-5.6211-0.23828-3.1914-0.39062-5.9414-0.48047-8.0312s-0.12109-3.5117-0.14062-4.1016c-0.14844-4.6289-0.30859-10.039-1.3984-15.449-1.0898-5.4102-3.1406-10.879-7.1484-15.43-0.5-0.57031-2.6797-2.9609-6.2695-5.2617-3.5781-2.2891-8.6406-4.5-14.809-4.5-0.39844 0-0.80859 0-1.2188 0.03125-6.1094 0.28906-11 2.6914-14.449 5.1406-1.7305 1.2305-3.1211 2.4805-4.1484 3.5195-1.0312 1.0391-1.7188 1.8711-2.0117 2.25-4.0117 5.0195-5.9414 11.02-6.9219 16.57s-1 10.73-1.0195 14.172c0 0.78906 0 2.3398-0.12891 4.5391-0.14062 2.1992-0.42969 5.0195-1.0312 8.2188-0.14844 0.82031-0.42969 2.2812-0.89844 4.0703-1.1914 4.5703-2.7617 8.1016-4.1211 11.18-0.67969 1.5391-1.3008 2.9688-1.7812 4.3906-0.46875 1.4219-0.80859 2.8516-0.82031 4.3711 0 0.98047 0.14844 1.9883 0.48828 2.9688 0.039063 0.10938 0.10938 0.32812 0.21875 0.58984 0.32031 0.78125 0.96094 2.0312 2.2695 3.0781 0.87891 0.69922 1.8398 1.1211 2.7383 1.3594 0.89844 0.23828 1.7383 0.30859 2.4609 0.30859 1 0 1.8203-0.14062 2.1797-0.19922 2.0586-0.33984 3.7812-1.1797 5.1484-2.1797 2.0508-1.5 3.3984-3.3008 4.4883-4.5 0.53125-0.60156 0.98828-1.0391 1.3008-1.25 0.16016-0.10937 0.26953-0.16016 0.33984-0.19141l0.14844-0.03125h0.050781l0.058594 0.011719 0.12109 0.10156c0.14062 0.12891 0.39062 0.46094 0.71875 0.94922 0.5 0.73047 1.1719 1.8008 2.2109 2.9102 1.0391 1.1094 2.4492 2.2305 4.3594 3.1289 1.7188 0.80859 3.3516 1.2305 4.6602 1.4414 1.3008 0.21875 2.3008 0.23828 2.7305 0.23828h0.050782c0.71094 0 2.75-0.050781 5.1992-0.83984 1.9688-0.62891 3.5508-1.5508 4.8008-2.5391 1.8789-1.4805 3.0508-3.0898 3.9297-4.0508 0.42969-0.48828 0.78125-0.80078 0.98828-0.92969 0.23047-0.12891 0.26953-0.14844 0.48047-0.16016h0.011719c0.12891 0 0.17969 0.019531 0.26953 0.050781 0.078125 0.03125 0.17969 0.089844 0.33984 0.21094 0.26953 0.21094 0.66016 0.62109 1.1289 1.1797 0.71094 0.82812 1.6211 1.9688 2.9297 3.0586 1.3008 1.0898 3.0391 2.0898 5.25 2.6289 0.60938 0.14844 1.8203 0.44922 3.3086 0.44922 1.3711 0 3.0391-0.26172 4.6602-1.1914 1.2305-0.69922 2.0898-1.6016 2.6797-2.3789 0.30078-0.39063 0.53125-0.75 0.69922-1.0586 0.17188-0.30078 0.30078-0.55078 0.35938-0.67969 0.60938-1.2188 0.89062-2.5312 0.89062-3.7812 0-1.4609-0.33984-2.8086-0.78906-4.1289z" />
      </g>
    </svg>`;
  }

  public setEnabled(enabled: boolean): void {
    if (this.enabled === enabled) return;
    
    this.enabled = enabled;
    
    if (enabled) {
      this.createThemeElements();
    } else {
      this.removeThemeElements();
    }
  }

  private createThemeElements(): void {
    // Halloween toggle button
    const toggleButton = this.createToggleButton();
    document.body.appendChild(toggleButton);
    this.elements.push(toggleButton);

    // Top left spider web
    const leftWeb = this.createSpiderWeb('top-left');
    document.body.appendChild(leftWeb);
    this.elements.push(leftWeb);

    // Top right spider web  
    const rightWeb = this.createSpiderWeb('top-right');
    document.body.appendChild(rightWeb);
    this.elements.push(rightWeb);

    // Floating ghost (appears every 5 seconds, gentle movement)
    this.startGhostAnimation();

    // Halloween particles
    const particles = this.createHalloweenParticles();
    document.body.appendChild(particles);
    this.elements.push(particles);

    console.log('ðŸŽƒ Halloween theme activated!');
  }

  private createToggleButton(): HTMLElement {
    const button = document.createElement('div');
    button.style.cssText = `
      position: fixed !important;
      bottom: 20px !important;
      left: 20px !important;
      z-index: 2147483647 !important;
      background: rgba(0, 0, 0, 0.8) !important;
      padding: 8px 12px !important;
      border-radius: 8px !important;
      color: white !important;
      font-size: 12px !important;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif !important;
      cursor: pointer !important;
      user-select: none !important;
      pointer-events: auto !important;
      transition: all 0.2s ease !important;
    `;
    
    button.innerHTML = 'ðŸŽƒ Halloween Theme (Click to disable)';
    
    button.addEventListener('click', () => {
      chrome.runtime.sendMessage({
        type: 'UPDATE_SETTINGS',
        payload: { ui: { halloweenThemeEnabled: false } }
      });
      this.setEnabled(false);
    });

    button.addEventListener('mouseenter', () => {
      button.style.background = 'rgba(0, 0, 0, 0.9)';
    });

    button.addEventListener('mouseleave', () => {
      button.style.background = 'rgba(0, 0, 0, 0.8)';
    });

    return button;
  }

  private createSpiderWeb(position: 'top-left' | 'top-right'): HTMLElement {
    const web = document.createElement('div');
    const isLeft = position === 'top-left';
    
    // Both webs are now 3x bigger for perfect symmetry
    const size = '360px';
    
    web.style.cssText = `
      position: fixed !important;
      top: -20px !important;
      ${isLeft ? 'left: -20px' : 'right: -20px'} !important;
      width: ${size} !important;
      height: ${size} !important;
      z-index: 2147483646 !important;
      opacity: 0 !important;
      pointer-events: none !important;
      transition: opacity 2s ease-in !important;
    `;
    
    web.innerHTML = this.createSpiderWebSvg(isLeft);
    
    // Fade in after a delay
    setTimeout(() => {
      web.style.opacity = '0.8';
      console.log(`ðŸ•·ï¸ ${isLeft ? 'Left (original)' : 'Right (mirrored)'} spider web visible (${size})`);
    }, 1000);
    
    return web;
  }

  private startGhostAnimation(): void {
    const interval = setInterval(() => {
      if (!this.enabled) {
        clearInterval(interval);
        return;
      }
      
      this.createFloatingGhost();
    }, 5000);
    
    this.intervals.push(interval as unknown as number);
  }

  private createFloatingGhost(): void {
    const ghost = document.createElement('div');
    
    // Random position
    const startX = Math.random() * (window.innerWidth - 100);
    const startY = Math.random() * (window.innerHeight - 100);
    const endX = Math.random() * (window.innerWidth - 100);
    const endY = Math.random() * (window.innerHeight - 100);
    
    ghost.style.cssText = `
      position: fixed !important;
      left: ${startX}px !important;
      top: ${startY}px !important;
      width: 60px !important;
      height: 60px !important;
      z-index: 2147483645 !important;
      opacity: 0 !important;
      pointer-events: none !important;
      transition: all 6s ease-in-out, opacity 2s ease-in-out !important;
      filter: drop-shadow(0 0 15px rgba(255, 255, 255, 0.6)) !important;
      transform: translateY(0px) !important;
    `;
    
    // Update ghost SVG with current dark mode setting
    ghost.innerHTML = this.createGhostSvg();
    document.body.appendChild(ghost);
    
    // Smooth fade in and gentle floating movement
    setTimeout(() => {
      ghost.style.opacity = '0.8';
      ghost.style.left = endX + 'px';
      ghost.style.top = endY + 'px';
      ghost.style.transform = 'translateY(-10px)';
    }, 200);
    
    // Add gentle floating animation
    setTimeout(() => {
      ghost.style.transform = 'translateY(10px)';
    }, 3000);
    
    // Smooth fade out over 2 seconds before removal
    setTimeout(() => {
      ghost.style.opacity = '0';
      ghost.style.transform = 'translateY(-20px) scale(0.8)';
    }, 5000);
    
    // Remove after fade out completes
    setTimeout(() => {
      if (ghost.parentNode) {
        ghost.parentNode.removeChild(ghost);
      }
    }, 7000);
  }

  private createHalloweenParticles(): HTMLElement {
    const particles = document.createElement('div');
    
    particles.style.cssText = `
      position: fixed !important;
      top: 0 !important;
      left: 0 !important;
      width: 100% !important;
      height: 100% !important;
      z-index: 2147483644 !important;
      pointer-events: none !important;
      opacity: 0.4 !important;
    `;
    
    // Create floating orange particles
    for (let i = 0; i < 6; i++) {
      const particle = document.createElement('div');
      particle.style.cssText = `
        position: absolute !important;
        width: 3px !important;
        height: 3px !important;
        background: orange !important;
        border-radius: 50% !important;
        animation: halloweenFloat ${15 + Math.random() * 10}s infinite linear !important;
        left: ${Math.random() * 100}% !important;
        animation-delay: ${Math.random() * 5}s !important;
      `;
      particles.appendChild(particle);
    }
    
    // Add CSS animation
    const style = document.createElement('style');
    style.textContent = `
      @keyframes halloweenFloat {
        0% { 
          transform: translateY(100vh) rotate(0deg);
          opacity: 0;
        }
        10% { opacity: 1; }
        90% { opacity: 1; }
        100% { 
          transform: translateY(-100px) rotate(360deg);
          opacity: 0;
        }
      }
    `;
    document.head.appendChild(style);
    this.elements.push(style);
    
    return particles;
  }

  private removeThemeElements(): void {
    // Clear intervals
    this.intervals.forEach(interval => clearInterval(interval));
    this.intervals = [];
    
    // Remove elements
    this.elements.forEach(element => {
      if (element.parentNode) {
        element.parentNode.removeChild(element);
      }
    });
    this.elements = [];
    
    console.log('ðŸŽƒ Halloween theme deactivated');
  }

  public destroy(): void {
    this.removeThemeElements();
  }
}

export default HalloweenContentTheme;